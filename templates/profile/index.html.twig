{# Gestion du profil utilisateur : permet de modifier ses informations et son mot de passe #}
{% extends 'base.html.twig' %}

{% block title %}Mon Profil - Auxilia E-commerce
{% endblock %}

{% block body %}
	<div class="container">
		<div style="margin-top: 2rem; margin-bottom: 2rem;">
			<h1 style="font-size: 2.5rem; color: var(--color-primary); margin-bottom: 0.5rem;">Mon Profil</h1>
			<p style="color: var(--color-text-light);">G√©rez vos informations personnelles</p>
		</div>

		<div
			class="profile-section" style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 3rem;">
			<!-- Formulaire -->
			<div>
				<div class="auth-form enhanced">
					<div class="auth-header">
						<h2>Informations personnelles</h2>
						<p class="auth-subtitle">Mettez √† jour vos informations</p>
					</div>

					{% for flash_error in app.flashes('success') %}
						<div class="alert" style="background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; margin-bottom: 1.5rem;">
							{{ flash_error }}
						</div>
					{% endfor %}

					{{ form_start(profileForm, {'attr': {'class': 'auth-form-inner'}}) }}
					{{ form_errors(profileForm) }}

					<div class="form-group">
						{{ form_label(profileForm.email) }}
						{{ form_widget(profileForm.email) }}
						{{ form_errors(profileForm.email) }}
					</div>

					<div class="form-row">
						<div class="form-group">
							{{ form_label(profileForm.firstName) }}
							{{ form_widget(profileForm.firstName) }}
							{{ form_errors(profileForm.firstName) }}
						</div>
						<div class="form-group">
							{{ form_label(profileForm.lastName) }}
							{{ form_widget(profileForm.lastName) }}
							{{ form_errors(profileForm.lastName) }}
						</div>
					</div>

					<div class="form-group">
						{{ form_label(profileForm.phone) }}
						{{ form_widget(profileForm.phone) }}
						{{ form_errors(profileForm.phone) }}
					</div>

					<div class="form-group">
						{{ form_label(profileForm.address) }}
						{{ form_widget(profileForm.address) }}
						{{ form_errors(profileForm.address) }}
					</div>

					<div class="form-row">
						<div class="form-group">
							{{ form_label(profileForm.postalCode) }}
							{{ form_widget(profileForm.postalCode) }}
							{{ form_errors(profileForm.postalCode) }}
						</div>
						<div class="form-group">
							{{ form_label(profileForm.city) }}
							{{ form_widget(profileForm.city) }}
							{{ form_errors(profileForm.city) }}
						</div>
					</div>

					<div class="form-group">
						{{ form_label(profileForm.country) }}
						{{ form_widget(profileForm.country) }}
						{{ form_errors(profileForm.country) }}
					</div>

					<div class="form-actions">
						<button type="submit" class="btn btn-primary btn-large btn-full">
							<span class="btn-text">Enregistrer les modifications</span>
							<span class="btn-icon">‚Üí</span>
						</button>
					</div>
					{{ form_end(profileForm) }}
				</div>
			</div>

			<!-- Informations du compte -->
			<div>
				<div style="background-color: white; border: 1px solid #e0e0e0; border-radius: 12px; padding: 2rem; margin-bottom: 2rem;">
					<h2 style="font-size: 1.5rem; color: var(--color-primary); margin-bottom: 1.5rem;">Informations du compte</h2>

					<div style="margin-bottom: 1.5rem;">
						<div style="font-size: 0.9rem; color: var(--color-text-light); margin-bottom: 0.5rem;">Email</div>
						<div style="font-size: 1.1rem; color: var(--color-text); font-weight: 500;">{{ user.email }}</div>
					</div>

					<div style="margin-bottom: 1.5rem;">
						<div style="font-size: 0.9rem; color: var(--color-text-light); margin-bottom: 0.5rem;">R√¥le</div>
						<div>
							{% for role in user.roles %}
								<span style="padding: 0.25rem 0.75rem; border-radius: 4px; font-size: 0.85rem;
										                                    {% if role == 'ROLE_ADMIN' %}
										                                        background-color: #fef3c7; color: #d97706;
										                                    {% else %}
										                                        background-color: #dbeafe; color: #1e40af;
										                                    {% endif %}">
									{{ role }}
								</span>
							{% endfor %}
						</div>
					</div>

					{% if user.firstName or user.lastName %}
						<div style="margin-bottom: 1.5rem;">
							<div style="font-size: 0.9rem; color: var(--color-text-light); margin-bottom: 0.5rem;">Nom complet</div>
							<div style="font-size: 1.1rem; color: var(--color-text); font-weight: 500;">
								{{ user.firstName }}
								{{ user.lastName }}
							</div>
						</div>
					{% endif %}

					{% if user.phone %}
						<div style="margin-bottom: 1.5rem;">
							<div style="font-size: 0.9rem; color: var(--color-text-light); margin-bottom: 0.5rem;">T√©l√©phone</div>
							<div style="font-size: 1.1rem; color: var(--color-text); font-weight: 500;">{{ user.phone }}</div>
						</div>
					{% endif %}

					{% if user.address or user.city or user.postalCode %}
						<div style="margin-bottom: 1.5rem;">
							<div style="font-size: 0.9rem; color: var(--color-text-light); margin-bottom: 0.5rem;">Adresse</div>
							<div style="font-size: 1.1rem; color: var(--color-text); font-weight: 500;">
								{% if user.address %}
									{{ user.address }}<br>
								{% endif %}
								{% if user.postalCode or user.city %}
									{{ user.postalCode }}
									{{ user.city }}
								{% endif %}
								{% if user.country %}<br>{{ user.country }}
								{% endif %}
							</div>
						</div>
					{% endif %}
				</div>

				<!-- Changement de mot de passe -->
				<div style="background-color: white; border: 1px solid #e0e0e0; border-radius: 12px; padding: 2rem; margin-bottom: 2rem;">
					<h2 style="font-size: 1.5rem; color: var(--color-primary); margin-bottom: 1.5rem;">Changer le mot de passe</h2>

					{% for flash_error in app.flashes('error') %}
						<div class="alert alert-danger" style="margin-bottom: 1.5rem;">{{ flash_error }}</div>
					{% endfor %}

					{{ form_start(passwordForm, {'attr': {'class': 'auth-form-inner'}}) }}
					{{ form_errors(passwordForm) }}

					<div class="form-group">
						{{ form_label(passwordForm.currentPassword) }}
						{{ form_widget(passwordForm.currentPassword) }}
						{{ form_errors(passwordForm.currentPassword) }}
					</div>

					<div class="form-group">
						{{ form_label(passwordForm.newPassword) }}
						{{ form_widget(passwordForm.newPassword) }}
						{{ form_errors(passwordForm.newPassword) }}
					</div>

					<div class="form-group">
						{{ form_label(passwordForm.confirmPassword) }}
						{{ form_widget(passwordForm.confirmPassword) }}
						{{ form_errors(passwordForm.confirmPassword) }}
					</div>

					<div class="form-actions">
						<button type="submit" class="btn btn-primary btn-large btn-full">
							<span class="btn-text">Changer le mot de passe</span>
							<span class="btn-icon">‚Üí</span>
						</button>
					</div>
					{{ form_end(passwordForm) }}
				</div>

				<div style="background-color: var(--color-light); border-radius: 12px; padding: 2rem;">
					<h3 style="font-size: 1.25rem; color: var(--color-primary); margin-bottom: 1rem;">Actions</h3>
					<div style="display: flex; flex-direction: column; gap: 1rem;">
						<a href="{{ path('app_orders') }}" class="btn btn-primary" style="text-align: center;">
							üõí Mes commandes
						</a>
						<a href="{{ path('app_product') }}" class="btn" style="background-color: #10b981; color: white; text-align: center;">
							üì¶ Voir les produits
						</a>
						<a href="{{ path('app_home') }}" class="btn btn-secondary" style="text-align: center;">
							üè† Retour √† l'accueil
						</a>
						{% if is_granted('ROLE_ADMIN') %}
							<a href="{{ path('app_admin_dashboard') }}" class="btn" style="background-color: #f59e0b; color: white; text-align: center;">
								üëë Dashboard Admin
							</a>
						{% endif %}
					</div>
				</div>
			</div>
		</div>
	</div>
{% endblock %}
