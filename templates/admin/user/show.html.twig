{% extends 'base.html.twig' %}

{% block title %}Profil Utilisateur #{{ user.id }}
	- Admin
{% endblock %}

{% block body %}
	<div class="container" style="margin-top: 2rem; margin-bottom: 5rem;">
		<div style="display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 3rem;">
			<div>
				<nav aria-label="breadcrumb">
					<ol style="list-style: none; padding: 0; display: flex; gap: 0.5rem; font-size: 0.9rem; margin-bottom: 0.5rem;">
						<li>
							<a href="{{ path('app_admin_users') }}" style="color: var(--color-primary); text-decoration: none;">Utilisateurs</a>
						</li>
						<li style="color: var(--color-text-light);">/</li>
						<li style="color: var(--color-text-light);">Profil #{{ user.id }}</li>
					</ol>
				</nav>
				<h1 style="font-size: 2.8rem; font-weight: 800; color: var(--color-dark); margin: 0; letter-spacing: -1px;">
					Profil
					<span style="color: var(--color-primary);">{{ user.email }}</span>
				</h1>
			</div>
			<a href="{{ path('app_admin_users') }}" class="btn btn-secondary" style="border-radius: 12px; padding: 0.8rem 1.5rem; display: flex; align-items: center; gap: 0.5rem; background: #f0f0f0; color: #333; border: 1px solid #ddd;">
				<i class="fas fa-arrow-left"></i>
				Retour à la liste
			</a>
		</div>

		<div
			style="display: grid; grid-template-columns: 1fr 2fr; gap: 2rem;">
			<!-- Colonne Gauche : Infos Carte de profil -->
			<div style="display: flex; flex-direction: column; gap: 2rem;">
				<div style="background: white; border: 1px solid #edf2f7; border-radius: 20px; padding: 2.5rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); text-align: center;">
					<div style="width: 120px; height: 120px; background: linear-gradient(135deg, var(--color-primary), var(--color-accent)); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 3rem; font-weight: bold; margin: 0 auto 1.5rem;">
						{{ user.email|first|upper }}
					</div>
					<h2 style="font-size: 1.25rem; word-break: break-all; margin-bottom: 0.5rem;">{{ user.email }}</h2>
					<div style="display: flex; justify-content: center; gap: 0.5rem; margin-bottom: 2rem;">
						{% for role in user.roles %}
							<span style="padding: 0.4rem 1rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 600;
																											                                {% if role == 'ROLE_ADMIN' %}
																											                                    background-color: #fef9c3; color: #854d0e;
																											                                {% else %}
																											                                    background-color: #dbeafe; color: #1e40af;
																											                                {% endif %}">
								{{ role }}
							</span>
						{% endfor %}
					</div>
					<p style="color: #718096; font-size: 0.9rem; margin-bottom: 0;">Membre depuis:
						{{ "now"|date('d/m/Y') }}</p>
				</div>

				<div style="background: white; border: 1px solid #edf2f7; border-radius: 20px; padding: 2rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
					<h3 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 1.5rem; color: var(--color-dark); display: flex; align-items: center; gap: 0.75rem;">
						<i class="fas fa-shield-alt" style="color: var(--color-primary);"></i>
						Sécurité
					</h3>
					<form method="post" action="{{ path('app_admin_user_reset_password', {'id': user.id}) }}" onsubmit="return confirm('Êtes-vous sûr de vouloir réinitialiser le mot de passe de cet utilisateur ? Un nouveau mot de passe temporaire sera généré.');" style="margin-bottom: 1rem;">
						<input type="hidden" name="_token" value="{{ csrf_token('reset-password' ~ user.id) }}">
						<button type="submit" class="btn btn-secondary btn-full" style="font-size: 0.9rem; padding: 0.8rem; border-radius: 12px; border: none; cursor: pointer;">
							<i class="fas fa-key" style="margin-right: 0.5rem;"></i>
							Réinitialiser le mot de passe
						</button>
					</form>
					<form method="post" action="{{ path('app_admin_user_toggle_active', {'id': user.id}) }}" onsubmit="return confirm('{{ user.isActive ? 'Êtes-vous sûr de vouloir désactiver ce compte ? L\'utilisateur ne pourra plus se connecter.' : 'Êtes-vous sûr de vouloir activer ce compte ? L\'utilisateur pourra à nouveau se connecter.' }}');">
						<input type="hidden" name="_token" value="{{ csrf_token('toggle-active' ~ user.id) }}">
						{% if 'ROLE_ADMIN' in user.roles and user.isActive %}
							<button type="button" class="btn btn-danger btn-full" style="font-size: 0.9rem; padding: 0.8rem; border-radius: 12px; border: none; cursor: not-allowed; opacity: 0.5;" disabled title="Les comptes administrateurs ne peuvent pas être désactivés">
								<i class="fas fa-user-slash" style="margin-right: 0.5rem;"></i>
								Désactiver le compte
							</button>
						{% elseif user == app.user and user.isActive %}
							<button type="button" class="btn btn-danger btn-full" style="font-size: 0.9rem; padding: 0.8rem; border-radius: 12px; border: none; cursor: not-allowed; opacity: 0.5;" disabled title="Vous ne pouvez pas désactiver votre propre compte">
								<i class="fas fa-user-slash" style="margin-right: 0.5rem;"></i>
								Désactiver le compte
							</button>
						{% else %}
							<button type="submit" class="btn {{ user.isActive ? 'btn-danger' : 'btn-success' }} btn-full" style="font-size: 0.9rem; padding: 0.8rem; border-radius: 12px; border: none; cursor: pointer;">
								<i class="fas fa-{{ user.isActive ? 'user-slash' : 'user-check' }}" style="margin-right: 0.5rem;"></i>
								{{ user.isActive ? 'Désactiver le compte' : 'Activer le compte' }}
							</button>
						{% endif %}
					</form>
				</div>
			</div>

			<!-- Colonne Droite : Historique & Détails -->
			<div style="display: flex; flex-direction: column; gap: 2rem;">
				<div style="background: white; border: 1px solid #edf2f7; border-radius: 20px; padding: 2.5rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
					<h3 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 2rem; color: var(--color-dark); display: flex; align-items: center; gap: 0.75rem;">
						<i class="fas fa-history" style="color: var(--color-primary);"></i>
						Activité récente
					</h3>

					<div style="display: flex; flex-direction: column; gap: 1rem;">
						{% if recentOrders|length > 0 %}
							{% for order in recentOrders %}
								<a href="{{ path('app_admin_order_show', {'id': order.id}) }}" style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: #f8fafc; border-radius: 12px; border: 1px solid #edf2f7; text-decoration: none; color: inherit; transition: all 0.2s ease; cursor: pointer;" onmouseover="this.style.background='#e2e8f0'; this.style.borderColor='#cbd5e0'; this.style.transform='translateY(-2px)'; this.style.boxShadow='0 4px 6px -1px rgba(0, 0, 0, 0.1)';" onmouseout="this.style.background='#f8fafc'; this.style.borderColor='#edf2f7'; this.style.transform='translateY(0)'; this.style.boxShadow='none';">
									<div style="display: flex; align-items: center; gap: 1rem;">
										<div style="width: 40px; height: 40px; background: #dbeafe; color: #1e40af; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 1rem;">
											<i class="fas fa-shopping-bag"></i>
										</div>
										<div>
											<p style="font-weight: 600; margin: 0; color: var(--color-dark);">Commande #{{ order.id }}</p>
											<p style="font-size: 0.8rem; color: #718096; margin: 0;">{{ order.dateat|date('d/m/Y H:i') }}</p>
										</div>
									</div>
									<div style="text-align: right;">
										<p style="font-weight: 700; color: var(--color-primary); margin: 0;">{{ order.total }}
											€</p>
										{% set status_info = {
											'paid': {'label': 'Payée', 'color': '#166534'},
											'confirmed': {'label': 'Confirmée', 'color': '#166534'},
											'pending': {'label': 'En attente', 'color': '#854d0e'},
											'delivered': {'label': 'Livrée', 'color': '#1e40af'},
											'cancelled': {'label': 'Annulée', 'color': '#991b1b'},
											'shipped': {'label': 'Expédiée', 'color': '#6b21a8'}
										} %}
										{% set info = status_info[order.status|lower] ?? {'label': order.status, 'color': '#475569'} %}
										<span style="font-size: 0.75rem; font-weight: 600; color: {{ info.color }};">{{ info.label }}</span>
									</div>
								</a>
							{% endfor %}
						{% else %}
							<div style="background: #f8fafc; border: 2px dashed #cbd5e0; border-radius: 12px; padding: 3rem; text-align: center; color: #718096;">
								<i class="fas fa-clock" style="font-size: 2.5rem; margin-bottom: 1rem; opacity: 0.5;"></i>
								<p>Aucune activité récente pour cet utilisateur.</p>
							</div>
						{% endif %}
					</div>
				</div>

				<div style="background: white; border: 1px solid #edf2f7; border-radius: 20px; padding: 2.5rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
					<h3 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1.5rem; color: var(--color-dark); display: flex; align-items: center; gap: 0.75rem;">
						<i class="fas fa-shopping-cart" style="color: var(--color-primary);"></i>
						Commandes associées ({{ allOrders|length }})
					</h3>

					{% if allOrders|length > 0 %}
						<div style="overflow-x: auto;">
							<table style="width: 100%; border-collapse: collapse;">
								<thead>
									<tr style="border-bottom: 2px solid #e0e0e0;">
										<th style="padding: 0.75rem; text-align: left; color: var(--color-text); font-size: 0.9rem;">ID</th>
										<th style="padding: 0.75rem; text-align: left; color: var(--color-text); font-size: 0.9rem;">Date</th>
										<th style="padding: 0.75rem; text-align: left; color: var(--color-text); font-size: 0.9rem;">Total</th>
										<th style="padding: 0.75rem; text-align: left; color: var(--color-text); font-size: 0.9rem;">Statut</th>
										<th style="padding: 0.75rem; text-align: left; color: var(--color-text); font-size: 0.9rem;">Actions</th>
									</tr>
								</thead>
								<tbody>
									{% for order in allOrders %}
										<tr style="border-bottom: 1px solid #e0e0e0;">
											<td style="padding: 0.75rem;">#{{ order.id }}</td>
											<td style="padding: 0.75rem; font-size: 0.9rem;">{{ order.dateat|date('d/m/Y H:i') }}</td>
											<td style="padding: 0.75rem; font-weight: bold; color: var(--color-primary); font-size: 0.9rem;">{{ order.total }} €</td>
											<td style="padding: 0.75rem;">
												{% set status_info = {
													'paid': {'label': 'Payée', 'style': 'background-color: #dcfce7; color: #166534;'},
													'confirmed': {'label': 'Confirmée', 'style': 'background-color: #dcfce7; color: #166534;'},
													'pending': {'label': 'En attente', 'style': 'background-color: #fef9c3; color: #854d0e;'},
													'delivered': {'label': 'Livrée', 'style': 'background-color: #dbeafe; color: #1e40af;'},
													'cancelled': {'label': 'Annulée', 'style': 'background-color: #fee2e2; color: #991b1b;'},
													'shipped': {'label': 'Expédiée', 'style': 'background-color: #f3e8ff; color: #6b21a8;'}
												} %}
												{% set info = status_info[order.status|lower] ?? {'label': order.status, 'style': 'background-color: #f1f5f9; color: #475569;'} %}
												<span style="padding: 0.3rem 0.6rem; border-radius: 9999px; font-size: 0.7rem; font-weight: 600; {{ info.style }} display: inline-block; white-space: nowrap;">
													<i class="fas fa-circle" style="font-size: 0.4rem; margin-right: 0.3rem; vertical-align: middle; opacity: 0.7;"></i>
													{{ info.label }}
												</span>
											</td>
											<td style="padding: 0.75rem;">
												<a href="{{ path('app_admin_order_show', {'id': order.id}) }}" class="btn btn-small" style="background-color: var(--color-accent); color: white; padding: 0.4rem 0.8rem; font-size: 0.85rem; text-decoration: none; border-radius: 4px;">Voir</a>
											</td>
										</tr>
									{% endfor %}
								</tbody>
							</table>
						</div>
					{% else %}
						<div style="background: #f8fafc; border: 2px dashed #cbd5e0; border-radius: 12px; padding: 3rem; text-align: center; color: #718096;">
							<i class="fas fa-shopping-cart" style="font-size: 2.5rem; margin-bottom: 1rem; opacity: 0.5;"></i>
							<p style="margin: 0;">Cet utilisateur n'a encore passé aucune commande.</p>
						</div>
					{% endif %}
				</div>
			</div>
		</div>
	</div>

	<style>
		.btn:hover {
			transform: translateY(-2px);
			filter: brightness(1.1);
			transition: all 0.3s;
		}
		.btn-full {
			display: block;
			width: 100%;
			text-align: center;
			text-decoration: none;
		}
	</style>
{% endblock %}
