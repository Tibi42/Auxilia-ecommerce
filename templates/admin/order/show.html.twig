{% extends 'base.html.twig' %}

{% block title %}Commande #{{ order.id }}
	- Admin
{% endblock %}

{% block body %}
	<div class="container" style="margin-top: 2rem; margin-bottom: 5rem;">
		<div style="display: flex; justify-content: space-between; align-items: flex-end; margin-bottom: 3rem;">
			<div>
				<nav aria-label="breadcrumb">
					<ol style="list-style: none; padding: 0; display: flex; gap: 0.5rem; font-size: 0.9rem; margin-bottom: 0.5rem;">
						<li>
							<a href="{{ path('app_admin_orders') }}" style="color: var(--color-primary); text-decoration: none;">Commandes</a>
						</li>
						<li style="color: var(--color-text-light);">/</li>
						<li style="color: var(--color-text-light);">Détails #{{ order.id }}</li>
					</ol>
				</nav>
				<h1 style="font-size: 2.8rem; font-weight: 800; color: var(--color-dark); margin: 0; letter-spacing: -1px;">
					Commande
					<span style="color: var(--color-primary);">#{{ order.id }}</span>
				</h1>
			</div>
			<a href="{{ path('app_admin_orders') }}" class="btn btn-secondary" style="border-radius: 12px; padding: 0.8rem 1.5rem; display: flex; align-items: center; gap: 0.5rem; background: #f0f0f0; color: #333; border: 1px solid #ddd;">
				<i class="fas fa-arrow-left"></i>
				Retour à la liste
			</a>
		</div>

		<div
			style="display: grid; grid-template-columns: 1.5fr 1fr; gap: 2rem;">
			<!-- Colonne Gauche : Détails & Items -->
			<div
				style="display: flex; flex-direction: column; gap: 2rem;">
				<!-- Infos principales -->
				<div style="background: white; border: 1px solid #edf2f7; border-radius: 20px; padding: 2.5rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
					<h3 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 2rem; color: var(--color-dark); display: flex; align-items: center; gap: 0.75rem;">
						<i class="fas fa-info-circle" style="color: var(--color-primary);"></i>
						Informations générales
					</h3>

					<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
						<div>
							<p style="font-size: 0.85rem; color: #718096; margin-bottom: 0.25rem; text-transform: uppercase; letter-spacing: 0.05em;">Date de création</p>
							<p style="font-size: 1.1rem; font-weight: 500;">{{ order.dateat|date('d/m/Y à H:i') }}</p>
						</div>
						<div>
							<p style="font-size: 0.85rem; color: #718096; margin-bottom: 0.25rem; text-transform: uppercase; letter-spacing: 0.05em;">Statut actuel</p>
							{% set status_info = {
                                'paid': {'label': 'Payée', 'style': 'background-color: #dcfce7; color: #166534;'},
                                'confirmed': {'label': 'Confirmée', 'style': 'background-color: #dcfce7; color: #166534;'},
                                'pending': {'label': 'En attente', 'style': 'background-color: #fef9c3; color: #854d0e;'},
                                'delivered': {'label': 'Livrée', 'style': 'background-color: #dbeafe; color: #1e40af;'},
                                'cancelled': {'label': 'Annulée', 'style': 'background-color: #fee2e2; color: #991b1b;'},
                                'shipped': {'label': 'Expédiée', 'style': 'background-color: #f3e8ff; color: #6b21a8;'}
                            } %}
							{% set info = status_info[order.status|lower] ?? {'label': order.status, 'style': 'background-color: #f1f5f9; color: #475569;'} %}
						{% set info = status_info[order.status|lower] ?? {'label': order.status, 'style': 'background-color: #f1f5f9; color: #475569;'} %}
							<span style="padding: 0.4rem 1rem; border-radius: 9999px; font-size: 0.85rem; font-weight: 600; {{ info.style }} display: inline-flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
								<i class="fas fa-circle" style="font-size: 0.5rem; opacity: 0.7;"></i>
								{{ info.label }}
							</span>

							<form action="{{ path('app_admin_order_status_update', {'id': order.id}) }}" method="post" style="display: flex; gap: 0.5rem; align-items: center;">
                                <select name="status" style="padding: 0.5rem; border: 1px solid #e2e8f0; border-radius: 6px; font-size: 0.9rem; background: #f8fafc; color: #334155;">
                                    {% for status_key, status_data in status_info %}
                                        <option value="{{ status_key }}" {% if order.status|lower == status_key %}selected{% endif %}>
                                            {{ status_data.label }}
                                        </option>
                                    {% endfor %}
                                </select>
                                <button type="submit" class="btn btn-small" style="background-color: var(--color-primary); color: white; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; font-size: 0.9rem;">
                                    Mettre à jour
                                </button>
                            </form>
						</div>
					</div>
				</div>

				<!-- Articles -->
				<div style="background: white; border: 1px solid #edf2f7; border-radius: 20px; padding: 2.5rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
					<h3 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 2rem; color: var(--color-dark); display: flex; align-items: center; gap: 0.75rem;">
						<i class="fas fa-shopping-bag" style="color: var(--color-primary);"></i>
						Articles de la commande
					</h3>

					{% if order.orderItems|length > 0 %}
						<div style="overflow-x: auto;">
							<table style="width: 100%; border-collapse: separate; border-spacing: 0;">
								<thead>
									<tr>
										<th style="text-align: left; padding: 1rem; color: #718096; font-weight: 600; font-size: 0.85rem; text-transform: uppercase;">Produit</th>
										<th style="text-align: center; padding: 1rem; color: #718096; font-weight: 600; font-size: 0.85rem; text-transform: uppercase;">Quantité</th>
										<th style="text-align: right; padding: 1rem; color: #718096; font-weight: 600; font-size: 0.85rem; text-transform: uppercase;">Prix unitaire</th>
										<th style="text-align: right; padding: 1rem; color: #718096; font-weight: 600; font-size: 0.85rem; text-transform: uppercase;">Total</th>
									</tr>
								</thead>
								<tbody>
									{% for item in order.orderItems %}
										<tr style="border-bottom: 1px solid #edf2f7;">
											<td style="padding: 1rem; border-bottom: 1px solid #f1f5f9;">
												<div style="display: flex; align-items: center; gap: 1rem;">
													{% if item.product and item.product.imageName %}
														<div style="width: 40px; height: 40px; border-radius: 8px; overflow: hidden; background: #f8fafc; border: 1px solid #e2e8f0;">
															<img src="/assets/products/{{ item.product.imageName }}" alt="{{ item.productName }}" style="width: 100%; height: 100%; object-fit: cover;">
														</div>
													{% else %}
														<div style="width: 40px; height: 40px; border-radius: 8px; background: #f1f5f9; display: flex; align-items: center; justify-content: center; color: #94a3b8;">
															<i class="fas fa-box"></i>
														</div>
													{% endif %}
													<span style="font-weight: 500; color: var(--color-dark);">{{ item.productName }}</span>
												</div>
											</td>
											<td style="padding: 1rem; text-align: center; border-bottom: 1px solid #f1f5f9; color: #4a5568;">
												x{{ item.quantity }}
											</td>
											<td style="padding: 1rem; text-align: right; border-bottom: 1px solid #f1f5f9; color: #4a5568;">
												{{ item.price }}
												€
											</td>
											<td style="padding: 1rem; text-align: right; border-bottom: 1px solid #f1f5f9; font-weight: 600; color: var(--color-dark);">
												{{ item.total }}
												€
											</td>
										</tr>
									{% endfor %}
								</tbody>
							</table>
						</div>
					{% else %}
						<div style="text-align: center; padding: 3rem 1rem; background: #f8fafc; border-radius: 12px; border: 2px dashed #e2e8f0;">
							<i class="fas fa-box-open" style="font-size: 2rem; color: #cbd5e0; margin-bottom: 1rem;"></i>
							<p style="color: #64748b; margin: 0;">Aucun article dans cette commande</p>
						</div>
					{% endif %}
				</div>
			</div>

			<!-- Colonne Droite : Client & Total -->
			<div
				style="display: flex; flex-direction: column; gap: 2rem;">
				<!-- Client -->
				<div style="background: white; border: 1px solid #edf2f7; border-radius: 20px; padding: 2rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);">
					<h3 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 1.5rem; color: var(--color-dark); display: flex; align-items: center; gap: 0.75rem;">
						<i class="fas fa-user" style="color: var(--color-primary);"></i>
						Informations client
					</h3>

					<div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem;">
						<div style="width: 48px; height: 48px; background: #e2e8f0; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #475569; font-weight: bold;">
							{{ order.user.email|first|upper }}
						</div>
						<div>
							<p style="font-weight: 600; margin: 0;">{{ order.user.email }}</p>
							<p style="font-size: 0.85rem; color: #718096; margin: 0;">ID Client: #{{ order.user.id }}</p>
						</div>
					</div>

					<a href="{{ path('app_admin_user_show', {'id': order.user.id}) }}" class="btn btn-secondary btn-full" style="font-size: 0.9rem; padding: 0.6rem; border-radius: 8px;">Voir le profil client</a>
				</div>

				<!-- Récapitulatif Financier -->
				<div style="background: var(--color-dark); color: white; border-radius: 20px; padding: 2rem; box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);">
					<h3 style="font-size: 1.1rem; font-weight: 600; margin-bottom: 1.5rem; opacity: 0.9; display: flex; align-items: center; gap: 0.75rem;">
						<i class="fas fa-receipt"></i>
						Récapitulatif
					</h3>

					<div style="display: flex; justify-content: space-between; margin-bottom: 1rem; opacity: 0.8;">
						<span>Sous-total</span>
						<span>{{ order.total }}
							€</span>
					</div>
					<div style="display: flex; justify-content: space-between; margin-bottom: 1.5rem; opacity: 0.8;">
						<span>Livraison</span>
						<span>0,00 €</span>
					</div>

					<div style="border-top: 1px solid rgba(255,255,255,0.1); padding-top: 1.5rem; display: flex; justify-content: space-between; align-items: flex-end;">
						<span style="font-size: 1.1rem; font-weight: 500;">Total</span>
						<div style="text-align: right;">
							<span style="display: block; font-size: 2rem; font-weight: 800; color: var(--color-primary);">{{ order.total }}
								€</span>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>

	<style>
		.btn:hover {
			transform: translateY(-2px);
			filter: brightness(1.1);
			transition: all 0.3s;
		}
		.btn-full {
			display: block;
			width: 100%;
			text-align: center;
			text-decoration: none;
		}
	</style>
{% endblock %}
