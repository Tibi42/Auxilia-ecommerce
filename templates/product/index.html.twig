{# Catalogue des produits : affiche la liste des produits avec filtres, tri et pagination #}
{% extends 'base.html.twig' %}

{% block title %}Produits - Auxilia E-commerce
{% endblock %}

{% block body %}
	<div class="container" style="margin-top: 2rem; margin-bottom: 2rem;">
		<h1 style="font-size: 2.5rem; color: var(--color-primary); margin-bottom: 2rem;">Nos produits</h1>

		<div class="product-toolbar" style="display: flex; gap: 1rem; flex-wrap: wrap; justify-content: space-between; align-items: center; margin-bottom: 2rem; background: #f8f9fa; padding: 1.5rem; border-radius: 12px; border: 1px solid #eee;">
			<div style="display: flex; gap: 1.5rem; flex-wrap: wrap; align-items: center;">
				<div class="category-control">
					<label for="category" style="margin-right: 0.5rem; font-weight: 600; color: var(--color-text);">Catégorie :</label>
					<select id="category" onchange="window.location.href=this.value" style="padding: 0.6rem 1rem; border-radius: 8px; border: 1px solid #ddd; background: white; cursor: pointer; min-width: 180px;">
						<option value="{{ path('app_product', {page: 1, limit: currentLimit, sort: currentSort, direction: currentDirection, q: q}) }}">Toutes les catégories</option>
						{% for category in categories %}
							<option value="{{ path('app_product', {page: 1, limit: currentLimit, sort: currentSort, direction: currentDirection, category: category.name, q: q}) }}" {% if currentCategory == category.name %} selected {% endif %}>
								{{ category.name }}
							</option>
						{% endfor %}
					</select>
				</div>

				<div class="sort-control">
					<label for="sort" style="margin-right: 0.5rem; font-weight: 600; color: var(--color-text);">Trier par :</label>
					<select id="sort" onchange="window.location.href=this.value" style="padding: 0.6rem 1rem; border-radius: 8px; border: 1px solid #ddd; background: white; cursor: pointer;">
						<option value="{{ path('app_product', {page: 1, limit: currentLimit, sort: 'p.price', direction: 'asc', category: currentCategory, q: q}) }}" {% if currentSort == 'p.price' and currentDirection == 'asc' %} selected {% endif %}>Prix croissant</option>
						<option value="{{ path('app_product', {page: 1, limit: currentLimit, sort: 'p.price', direction: 'desc', category: currentCategory, q: q}) }}" {% if currentSort == 'p.price' and currentDirection == 'desc' %} selected {% endif %}>Prix décroissant</option>
						<option value="{{ path('app_product', {page: 1, limit: currentLimit, sort: 'p.name', direction: 'asc', category: currentCategory, q: q}) }}" {% if currentSort == 'p.name' and currentDirection == 'asc' %} selected {% endif %}>Nom (A-Z)</option>
					</select>
				</div>
			</div>

			<div class="limit-control">
				<label for="limit" style="margin-right: 0.5rem; font-weight: 600; color: var(--color-text);">Afficher :</label>
				<select id="limit" onchange="window.location.href=this.value" style="padding: 0.6rem 1rem; border-radius: 8px; border: 1px solid #ddd; background: white; cursor: pointer;">
					<option value="{{ path('app_product', {page: 1, limit: 9, sort: currentSort, direction: currentDirection, category: currentCategory, q: q}) }}" {% if currentLimit == 9 %} selected {% endif %}>9 produits</option>
					<option value="{{ path('app_product', {page: 1, limit: 18, sort: currentSort, direction: currentDirection, category: currentCategory, q: q}) }}" {% if currentLimit == 18 %} selected {% endif %}>18 produits</option>
					<option value="{{ path('app_product', {page: 1, limit: 36, sort: currentSort, direction: currentDirection, category: currentCategory, q: q}) }}" {% if currentLimit == 36 %} selected {% endif %}>36 produits</option>
				</select>
			</div>
		</div>

		{% if pagination|length > 0 %}
			<div class="products-grid">
				{% for product in pagination %}
					{% include 'components/product_card.html.twig' with {product: product} %}
				{% endfor %}
			</div>

			<div class="pagination" style="display: flex; justify-content: center; margin-top: 2rem;">
				{{ knp_pagination_render(pagination) }}
			</div>
		{% else %}
			<div class="no-products">
				<p>Aucun produit disponible pour le moment.</p>
			</div>
		{% endif %}
	</div>
{% endblock %}
